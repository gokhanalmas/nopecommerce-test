/*
* Copyright 2013 Seven Spikes Ltd. All rights reserved. (http://www.nop-templates.com)
* http://www.nop-templates.com/t/licensinginfo
*/


$(document).ready(function () { ReplaceAddToCartButtons(); var a = new AjaxCartManager; $("body").on("click", "input.nopAjaxCartProductListAddToCartButton", function (b) { a.addProductToCart(b, a) }); $("body").on("click", "input.nopAjaxCartProductVariantAddToCartButton", function (b) { var c = !1; $(this).hasClass("miniProductDetailsViewAddToCartButton") && (c = !0); a.addProductVariantToCart(b, a, c) }); $(document).on("nopAjaxFiltersFiltrationCompleteEvent", ReplaceAddToCartButtons); $(document).on("nopQuickViewDataShownEvent", ReplaceAddToCartButtons); a.addProductPanelAjaxBusyToPage(); a.addModelDialogs() }); function AjaxCartManager() { this.getAddProductToCartUrl = GetAddProductToCartUrl; this.getCheckProductAttributesUrl = GetCheckProductAttributesUrl; this.getMiniProductDetailsViewUrl = GetMiniProductDetailsViewUrl; this.showMiniProductDetailsView = ShowMiniProductDetailsView; this.setMiniProductDetailsViewAddToCartProductQuantity = SetMiniProductDetailsViewAddToCartProductQuantity; this.getAddProductVariantToCartUrl = GetAddProductVariantToCartUrl; this.getAddToCartProductQuantity = GetAddToCartProductQuantity; this.getAddToCartProductVariantQuantity = GetAddToCartProductVariantQuantity; this.addProductToCart = AddProductToCart; this.addProductVariantToCart = AddProductVariantToCart; this.refreshMiniShoppingCart = RefreshMiniShoppingCart; this.refreshFlyoutShoppingCart = RefreshFlyoutShoppingCart; this.refreshShoppingCartBox = RefreshShoppingCartBox; this.refreshShoppingCartMenuLink = RefreshShoppingCartMenuLink; this.waitForAjaxRequest = !1; this.getPageElementSelector = function () { return "body" }; this.addProductPanelAjaxBusyToPage = function () { var a = this.getPageElementSelector(), a = $(a); 0 == a.find(".nopAjaxCartPanelAjaxBusy").length && (a.prepend('<div class="nopAjaxCartPanelAjaxBusy"></div><div class="clear"></div>'), $(".nopAjaxCartPanelAjaxBusy").hide()); 0 == a.find(".nopAjaxCartPanelAjaxBusy").length && (a.prepend('<div class="nopAjaxCartPanelAjaxBusy"></div><div class="clear"></div>'), $(".nopAjaxCartPanelAjaxBusy").hide()) }; this.addModelDialogs = function () { var a = this.getPageElementSelector(), a = $(a); 0 < a.length && (a.prepend('<div class="productAddedToCartWindow"></div>'), a.prepend('<div class="miniProductDetailsView"></div>'), a.prepend('<div class="addProductVariantToCartErrors"></div>'), a.prepend('<div class="addProductToCartErrors"></div>'), $(".miniProductDetailsView").kendoWindow({ draggable: !1, resizable: !1, modal: !0, actions: ["Close"], animation: !1, visible: !1 }).data("kendoWindow").wrapper.addClass("ajaxCart")); $(".productAddedToCartWindow").kendoWindow({ draggable: !1, resizable: !1, modal: !0, actions: ["Close"], animation: !1, visible: !1 }).data("kendoWindow").wrapper.addClass("ajaxCart") }; this.showProductAddedToCartWindow = function (a) { $(".productAddedToCartWindow").html($(a).html()); a = $(".productAddedToCartWindow").data("kendoWindow"); a.center(); a.open() }; this.showAddProductToCartErrors = function (a) { var b = $(".addProductToCartErrors").data("kendoWindow"); b || (b = $(".addProductToCartErrors").kendoWindow({ draggable: !1, resizable: !1, width: "300px", height: "100px", modal: !0, actions: ["Close"], animation: !1, visible: !1 }).data("kendoWindow"), b.wrapper.addClass("ajaxCart")); b.content(a); b.center(); b.open() }; this.showMiniProductDetailsViewModalDialog = function (a) { a = $(".miniProductDetailsView").data("kendoWindow").content('<div class="miniProductDetailsPanelAjaxBusy"></div><div class="clear"></div>' + a); a.center(); a.open() }; this.hideMiniProductDetailsViewModalDialog = function () { $(".miniProductDetailsView").data("kendoWindow").close() }; this.showAddProductVariantAddToCartErrors = function (a, b) { if (b) $(".miniProductDetailsView .message-error").html(a); else { var c = $(".addProductVariantToCartErrors").data("kendoWindow"); c || (c = $(".addProductVariantToCartErrors").kendoWindow({ draggable: !1, resizable: !1, width: "300px", height: "100px", modal: !0, actions: ["Close"], animation: !1, visible: !1 }).data("kendoWindow"), c.wrapper.addClass("ajaxCart")); c.content(a); c.center(); c.open() } }; this.showProductPanelAjaxBusy = function () { var a = this.getPageElementSelector(), b = $(a); 0 < b.length && (a = b.height(), b = b.width(), $(".nopAjaxCartPanelAjaxBusy").height(a), $(".nopAjaxCartPanelAjaxBusy").width(b), $(".nopAjaxCartPanelAjaxBusy").show()) }; this.hideProductPanelAjaxBusy = function () { $(".nopAjaxCartPanelAjaxBusy").hide() }; this.showMiniProductDetailsPanelAjaxBusy = function () { if (0 < $(".miniProductDetailsView").length) { var a = $(".miniProductDetailsView").parent().height(), b = $(".miniProductDetailsView").parent().width(); $(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").height(a - 10); $(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").width(b - 10); $(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").show() } }; this.hideMiniProductDetailsPanelAjaxBusy = function () { $(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").hide() }; this.showProductDetailsPanelAjaxBusy = function (a) { a ? this.showMiniProductDetailsPanelAjaxBusy() : this.showProductPanelAjaxBusy() }; this.hideProductDetailsPanelAjaxBusy = function (a) { a ? this.hideMiniProductDetailsPanelAjaxBusy() : this.hideProductPanelAjaxBusy() } } function ReplaceAddToCartButtons() { var a = GetAddProductToCartAjaxButtonUrl(), b = GetAddProductVariantToCartAjaxButtonUrl(), c = GetProductPageAddToCartButtonSelector(), d = GetProductBoxAddToCartButtonSelector(); if (void 0 != c && "" != d && "" != b) { var e = []; $(c).each(function () { var a = $(this).attr("data-productVariantId"); (void 0 == a || "" == a) && e.push(this) }); for (c = 0; c < e.length; c++) { var f = GetProductIdForProductVariantButton(e[c]); ReplaceAddToCartButton(e[c], f, b) } } if (void 0 != d && "" != d && "" != a) { var g = []; $(d).each(function () { var a = $(this).attr("data-productId"); (void 0 == a || "" == a) && g.push(this) }); for (c = 0; c < g.length; c++) f = GetProductIdForProductBoxButton(g[c]), ReplaceAddToCartButton(g[c], f, a) } } function ReplaceAddToCartButton(a, b, c) { if (0 != b) { var d = GetButtonValue(a); "" != d && $.ajax({ cache: !1, type: "POST", data: $.toJSON({ productId: b, buttonValue: d, isAjax: !0 }), contentType: "application/json; charset=utf-8", url: c, success: function (b) { "" != b && $(a).replaceWith(b) }, error: function () { } }) } } function GetAddProductVariantToCartAjaxButtonUrl() { var a = $(".ajaxCartInfo").attr("data-getAddProductVariantToCartAjaxButtonUrl"); void 0 == a && (a = ""); return a } function GetAddProductToCartAjaxButtonUrl() { var a = $(".ajaxCartInfo").attr("data-getAddProductToCartAjaxButtonUrl"); void 0 == a && (a = ""); return a } function GetProductPageAddToCartButtonSelector() { var a = $(".ajaxCartInfo").attr("data-productPageAddToCartButtonSelector"); void 0 == a && (a = ""); return a } function GetProductPageAddToCartElementSelector() { var a = $(".ajaxCartInfo").attr("data-productPageAddToCartElementSelector"); void 0 == a && (a = ""); return a } function GetQuantityBoxOnProductPageSelector() { var a = $(".ajaxCartInfo").attr("data-quantityBoxOnProductPageSelector"); void 0 == a && (a = ""); return a } function GetProductBoxAddToCartButtonSelector() { var a = $(".ajaxCartInfo").attr("data-productBoxAddToCartButtonSelector"); void 0 == a && (a = ""); return a } function GetProductBoxProductItemElementSelector() { var a = $(".ajaxCartInfo").attr("data-productBoxProductItemElementSelector"); void 0 == a && (a = ""); return a } function GetProductIdForProductBoxButton(a) { var b = GetProductBoxProductItemElementSelector(); if (void 0 == b || "" == b) return 0; a = $(a).parents(b).attr("data-productid"); void 0 == a && (a = 0); return a } function GetProductIdForProductVariantButton(a) { if (void 0 == $(a).attr("onclick")) return 0; a = $(a).attr("onclick").split("/addproductvarianttocart/")[1].split("/")[0]; return void 0 == a ? 0 : parseInt(a) || 0 } function GetButtonValue(a) { a = $(a).attr("value"); void 0 == a && (a = ""); return a } function AddProductToCart(a, b) { if (!b.waitForAjaxRequest) { b.waitForAjaxRequest = !0; var c = $(a.currentTarget), d = b.getAddProductToCartUrl(c), e = b.getCheckProductAttributesUrl(), f = c.attr("data-productId"), g = b.getAddToCartProductQuantity(c), c = { productId: f, quantity: g }; b.showProductPanelAjaxBusy(); var h = !1, j = !1; $.ajax({ cache: !1, async: !1, type: "POST", dataType: "json", data: $.toJSON(c), contentType: "application/json; charset=utf-8", url: e, success: function (a) { h = a.HasProductAttributes }, error: function () { alert("Request for page " + d + " failed."); j = !0 } }); j ? (b.hideProductPanelAjaxBusy(), b.waitForAjaxRequest = !1) : h ? (b.showMiniProductDetailsView(f, g), b.hideProductPanelAjaxBusy(), b.waitForAjaxRequest = !1) : $.ajax({ cache: !1, type: "POST", dataType: "json", data: $.toJSON(c), contentType: "application/json; charset=utf-8", url: d, success: function (a) { b.hideProductPanelAjaxBusy(); b.waitForAjaxRequest = !1; "success" == a.Status ? (b.refreshMiniShoppingCart(), b.refreshFlyoutShoppingCart(), b.refreshShoppingCartBox(), b.refreshShoppingCartMenuLink(g), b.showProductAddedToCartWindow(a.ProductAddedToCartWindow), $.event.trigger({ type: "nopAjaxCartProductAddedToCartEvent" })) : "warning" == a.Status ? b.showAddProductToCartErrors(a.AddToCartWarnings) : "error" == a.Status && b.showAddProductToCartErrors(a.ErrorMessage) }, error: function () { b.hideProductPanelAjaxBusy(); alert("Loading the page failed."); b.waitForAjaxRequest = !1 } }) } } function AddProductVariantToCart(a, b, c) { void 0 == c && (c = !1); if (!b.waitForAjaxRequest) { b.waitForAjaxRequest = !0; var d = $(a.currentTarget); a = b.getAddProductVariantToCartUrl(); var e = d.attr("data-productVariantId"), f = b.getAddToCartProductVariantQuantity(d), d = $(d).closest("form").serialize(); 0 == d.length && (d = b.getPageElementSelector(), formSelector = $(d).find("form"), d = $(formSelector).serialize()); d += "&productVariantId=" + e; b.showProductDetailsPanelAjaxBusy(c); $.ajax({ cache: !1, type: "POST", data: d, url: a, success: function (a) { "warning" == a.Status || "error" == a.Status ? (b.hideProductDetailsPanelAjaxBusy(c), b.waitForAjaxRequest = !1, b.showAddProductVariantAddToCartErrors(a.AddToCartWarnings, c)) : (b.refreshMiniShoppingCart(), b.refreshShoppingCartBox(), b.refreshShoppingCartMenuLink(f), b.refreshFlyoutShoppingCart(), c && b.hideMiniProductDetailsViewModalDialog(), b.hideProductDetailsPanelAjaxBusy(c), b.waitForAjaxRequest = !1, b.showProductAddedToCartWindow(a.ProductAddedToCartWindow), $.event.trigger({ type: "nopAjaxCartProductAddedToCartEvent" })) }, error: function () { b.hideProductDetailsPanelAjaxBusy(c); alert("Loading the page failed."); b.waitForAjaxRequest = !1 } }) } } function GetAddProductToCartUrl() { return $("#addProductToCartUrl").val() } function GetCheckProductAttributesUrl() { return $("#checkProductAttributesUrl").val() } function GetMiniProductDetailsViewUrl() { return $("#getMiniProductDetailsViewUrl").val() } function ShowMiniProductDetailsView(a, b) { var c = { productId: a }, d = this.getMiniProductDetailsViewUrl(), e = this; $.ajax({ cache: !1, async: !1, type: "POST", data: $.toJSON(c), contentType: "application/json; charset=utf-8", url: d, success: function (a) { e.showMiniProductDetailsViewModalDialog(a); e.setMiniProductDetailsViewAddToCartProductQuantity(b) }, error: function () { alert("Request for page " + d + " failed.") } }) } function SetMiniProductDetailsViewAddToCartProductQuantity(a) { var b = $(".miniProductDetailsView .miniProductDetailsViewAddToCartButton"); 0 < b.length && (b = ".miniProductDetailsView #addtocart_" + b.attr("data-ProductVariantId") + "_EnteredQuantity", 0 < $(b).length && $(b).val(a)) } function GetAddProductVariantToCartUrl() { return $("#addProductVariantToCartUrl").val() } function GetAddToCartProductQuantity(a) { var b = 1; a = $(a).attr("data-productId"); "" != a && (a = "#productQuantity" + a, 0 < $(a).length && (a = $(a).val(), 0 < a && (b = a))); return b } function GetAddToCartProductVariantQuantity(a) { var b = 1; a = $(a).attr("data-productVariantId"); "" != a && (a = "#addtocart_" + a + "_EnteredQuantity", 0 < $(a).length && (a = $(a).val(), 0 < a && (b = a))); return b } function GetProductVariantIdAndEnteredQuantityString(a) { var b = "", c = $(a).attr("data-productVariantId"); "" != c && (a = $(a).siblings().filter('[id*="EnteredQuantity"]').val(), b = c + "-" + a); return b } function RefreshMiniShoppingCart() { var a = $("#miniShoppingCartUrl").val(); 0 < $(".block.block-shoppingcart").length && $.ajax({ cache: !1, type: "GET", url: a, success: function (a) { a = $(a).filter(".block.block-shoppingcart"); $(".block.block-shoppingcart").replaceWith(a) }, error: function () { alert("Refreshing mini shopping cart failed.") } }) } function RefreshShoppingCartBox() { var a = $("#shoppingCartBoxUrl").val(), b = $("#shoppingCartBoxPanelSelector").val(); 0 < $(b).length && $.ajax({ cache: !1, type: "GET", url: a, success: function (a) { a = $(a).filter(b); $(b).replaceWith(a) }, error: function () { alert("Refreshing mini shopping cart box failed.") } }) } function RefreshFlyoutShoppingCart() { var a = $("#flyoutShoppingCartUrl").val(), b = $("#flyoutShoppingCartPanelSelector").val(); 0 < $(b).length && $.ajax({ cache: !1, type: "GET", url: a, success: function (a) { a = $(a).filter(b); $(b).replaceWith(a) }, error: function () { alert("Refreshing flyout shopping cart failed.") } }) } function RefreshShoppingCartMenuLink(a) { var b = '.header-links a[href="/cart"]'; 0 < $("#shoppingCartMenuLinkSelector").length && void 0 != $("#shoppingCartMenuLinkSelector").val() && (b = $("#shoppingCartMenuLinkSelector").val(), b = $("<div/>").html(b).text()); b = $(b).filter(":last"); if (0 < b.length) { var c = b.html(), c = /\d+/.exec(c); a = parseInt(c) + parseInt(a); b.html("(" + a + ")") } } function CloseProductAddedToCartWindow() { var a = $(".productAddedToCartWindow").data("kendoWindow"); a && a.close() };